{% extends 'base.html.twig' %}
{% block title%} Analizador {% endblock %}
{% block body %}
	<div class="row">
		<div class="col-lg-12 col-sm-12 col-xs-12">
            <div class="white-box">
                <h3 class="box-title m-b-0">Comision analizadora</h3>
                <p class="text-muted m-b-40">UNABAS</p>
                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active">
                    	<a href="#presupuesto" aria-controls="presupuesto" role="tab" data-toggle="tab" aria-expanded="true">
                    		<span class="visible-xs">
                    			<i class="ti-presupuesto"></i>
                    		</span>
                    		<span class="hidden-xs">Analisis de 20% de incremento</span>
                    	</a>
                    </li>
                    <li role="presentation" class="">
                    	<a href="#criticidad" aria-controls="criticidad" role="tab" data-toggle="tab" aria-expanded="false">
                    		<span class="visible-xs">
                    			<i class="ti-user"></i>
                    		</span> 
                    		<span class="hidden-xs">Analisis de Criticidad</span>
                    	</a>
                    </li>
                </ul>
                <!-- Tab panes -->
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="presupuesto">
                        <div class="col-sm-12">
                        <div class="white-box">
                            <h3 class="box-title">Analisis Presupuestario</h3>
                            <p class="text-muted">Recuerde que no el monto total a incrementar no debe ser mayor al 20% de la compra de periodo anterior</p>
                            <div class="table-responsive">
                                <table class="table color-bordered-table red-bordered-table" id="tabla">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Codigo de Compra(LP,LA,CD)</th>
                                            <th>Contrato</th>
                                            <th>Proveedor</th>
                                            <th>Producto</th>
                                            <th>Monto Comprado</th>
                                            <th>Precio Unitario</th>
                                            <th>Unidades a incrementar</th>
                                            <th>SubTotal</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>LP N. 21/2017</td>
                                            <td>Contrato</td>
                                            <td>Proveedor</td>
                                            <td>Producto</td>
                                            <td>1223.00</td>
                                            <td>4.1</td>
                                            <td><input type="number"></td>
                                            <td>0</td>
                                        </tr>
                                        <tr>
                                            <td>1</td>
                                            <td>LP N. 21/2017</td>
                                            <td>Contrato</td>
                                            <td>Proveedor</td>
                                            <td>Producto</td>
                                            <td>1223.00</td>
                                            <td>4.1</td>
                                            <td><input type="number"></td>
                                            <td>0</td>
                                        </tr>
                                        <tr>
                                            <td>1</td>
                                            <td>LP N. 21/2017</td>
                                            <td>Contrato</td>
                                            <td>Proveedor</td>
                                            <td>Producto</td>
                                            <td>1223.00</td>
                                            <td>4.1</td>
                                            <td><input type="number"></td>
                                            <td>0</td>
                                        </tr>
                                        <tr>
                                            <td>1</td>
                                            <td>LP N. 21/2017</td>
                                            <td>Contrato</td>
                                            <td>Proveedor</td>
                                            <td>Producto</td>
                                            <td>23.00</td>
                                            <td>4.1</td>
                                            <td><input type="number"></td>
                                            <td>0</td>
                                        </tr>
                                        <tr>
                                            <td>1</td>
                                            <td>LP N. 21/2017</td>
                                            <td>Contrato</td>
                                            <td>Proveedor</td>
                                            <td>Producto</td>
                                            <td>12430</td>
                                            <td>45.1</td>
                                            <td><input type="number"></td>
                                            <td>0</td>
                                        </tr>
                                        <tr>
                                            <td>1</td>
                                            <td>LP N. 21/2017</td>
                                            <td>Contrato</td>
                                            <td>Proveedor</td>
                                            <td>Producto</td>
                                            <td>12100</td>
                                            <td>4.1</td>
                                            <td><input type="number"></td>
                                            <td>0</td>
                                        </tr>
                                        
                                    </tbody>
                                     <tfoot>
                                        <tr>
                                            <td>Total</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td id="montoTotalComprado"></td>
                                            <td></td>
                                            <td></td>
                                            <td id="TotalAComprar"></td>
                                        </tr>
                                    </tfoot>
                                </table>
                                <a class="btn btn-info">calcular</a>
                            </div>
                        </div>
                    </div>
                        <div class="clearfix"></div>
                    </div>


                    <div role="tabpanel" class="tab-pane" id="criticidad">
                        
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
        </div>
	</div>
{% endblock %}

{% block js %}
{{ parent() }}
<script type="text/javascript">
	$(document).ready(function() {
        iniciar();
        calcular();
    });
    function calcularSubTotales() {
        var subtotal = 0;
        $('#tabla tbody tr').each(function () {
            
            subtotal = subtotal + parseInt($(this).find("td").eq(8).html());
            });
        $('#TotalAComprar').html(subtotal);
        return subtotal;
             
    }
    function iniciar() {
        var monto_comprado = 0;
        
        $('#tabla tbody tr').each(function () {
            monto_comprado = monto_comprado + parseInt($(this).find("td").eq(5).html());
            $(this).find("td").eq(8).html(0);
            calcularSubTotales();

        });
        $('#montoTotalComprado').html(monto_comprado);
        

    }
    function calcular() {
        var fila = $("input[type=number]");
        fila.change(function() {
            $('#tabla tbody tr').each(function () {

            var monto_comprado = $(this).find("td").eq(5).html();
            var precio_unitario = $(this).find("td").eq(6).html();
            var unidadesComprar = $(this).find("td").eq(7).find("input").val();
            var subtotal = $(this).find("td").eq(8);
            subtotal.html((unidadesComprar*precio_unitario).toFixed(2));
            });
            var montoOriginal = parseInt($('#montoTotalComprado').html());
            var montoNuevo = calcularSubTotales();
            if(montoNuevo>(montoOriginal*0.2)){
                fila.val(0);
                var rowPadre = fila.parent();
                var PadrerowPadre = rowPadre.parent();
                PadrerowPadre.find("td").eq(8).html(0);

            }
        });
    }

    /*function calcularTotales() {
        var TotalComprado=0;
        var subTotalAComprar = 0;
        $('#tabla tbody tr').each(function () {
            var monto_comprado = $(this).find("td").eq(5).html();
            TotalComprado =TotalComprado+parseInt(monto_comprado);
            var subtotal = $(this).find("td").eq(8).html();
            subTotalAComprar =+ parseInt(subtotal);

        });
        var montoT=$('#montoTotalComprado');
        var tc=$('#TotalAComprar');
        montoT.html(TotalComprado);
        tc.html(subTotalAComprar);
        if (parseInt($('#montoTotalComprado').html())*0.20 <= parseInt($('#TotalAComprar').html())) {

            return true;
        }
        else{
            return false;
        }
    }
    function calcular() {
        $('#tabla tbody tr').each(function () {

            var monto_comprado = $(this).find("td").eq(5).html();
            var precio_unitario = $(this).find("td").eq(6).html();
            var unidadesComprar = $(this).find("td").eq(7).find("input").val();
            var subtotal = $(this).find("td").eq(8);
            if (calcularTotales) {
                subtotal.html((unidadesComprar*precio_unitario).toFixed(2));
            }
            else{
                subtotal.html('<p>error este valor hace que se pase del 20%</p>');
            }
            

        });
    }
*/
</script>
    
{% endblock %}